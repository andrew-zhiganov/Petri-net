<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <title>Сети Петри</title>

    <link href="interactive_tree.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="d3.v2.js"></script>
    <script type="text/javascript" src="jquery-2.2.4.min.js"></script>
    <script type="text/javascript" src="interactive_tree.js"></script>
    <script type="text/javascript" src="interactive_tree_full.js"></script>
    <script type="text/javascript" src="generate_tree.js"></script>
</head>
<body>
    <table>
        <tr>
            <td>
                <svg width="500" height="400">
                    <marker id="triangle" viewBox="0 0 10 10" refX="0" refY="5" markerUnits="strokeWidth" markerWidth="5" markerHeight="5" orient="auto">
                    <path d="M 0 0 L 10 5 L 0 10 z"/>
                    </marker>
                    <circle id="p1" cx="240" cy="40" r="25" stroke="black" stroke-width="1" fill="white"/>
                    <circle id="p2" cx="120" cy="120" r="25" stroke="black" stroke-width="1" fill="white"/>
                    <circle id="p3" cx="360" cy="120" r="25" stroke="black" stroke-width="1" fill="white"/>
                    <circle id="p4" cx="120" cy="240" r="25" stroke="black" stroke-width="1" fill="white"/>
                    <circle id="p5" cx="360" cy="240" r="25" stroke="black" stroke-width="1" fill="white"/>

                    <text id="p1" x="240" y="40" text-anchor="middle" alignment-baseline="middle"></text>
                    <text id="p2" x="120" y="120" text-anchor="middle" alignment-baseline="middle"></text>
                    <text id="p3" x="360" y="120" text-anchor="middle" alignment-baseline="middle"></text>
                    <text id="p4" x="120" y="240" text-anchor="middle" alignment-baseline="middle"></text>
                    <text id="p5" x="360" y="240" text-anchor="middle" alignment-baseline="middle"></text>

                    <text x="240" y="80" text-anchor="middle" alignment-baseline="middle">P1</text>
                    <text x="160" y="120" text-anchor="middle" alignment-baseline="middle">P2</text>
                    <text x="320" y="120" text-anchor="middle" alignment-baseline="middle">P3</text>
                    <text x="160" y="240" text-anchor="middle" alignment-baseline="middle">P4</text>
                    <text x="320" y="240" text-anchor="middle" alignment-baseline="middle">P5</text>

                    <text x="155" y="65" text-anchor="middle" alignment-baseline="middle">t1</text>
                    <text x="325" y="65" text-anchor="middle" alignment-baseline="middle">t2</text>
                    <text x="95" y="165" text-anchor="middle" alignment-baseline="middle">t3</text>
                    <text x="335" y="165" text-anchor="middle" alignment-baseline="middle">t4</text>
                    <text x="205" y="320" text-anchor="middle" alignment-baseline="middle">t5</text>
                    <text x="470" y="110" text-anchor="middle" alignment-baseline="middle">t6</text>

                    <rect id="t1" x="155" y="75" width="50" height="4" fill="black"/>
                    <rect id="t2" x="275" y="75" width="50" height="4" fill="black"/>
                    <rect id="t3" x="95" y="175" width="50" height="4" fill="black"/>
                    <rect id="t4" x="335" y="175" width="50" height="4" fill="black"/>
                    <rect id="t5" x="215" y="320" width="50" height="4" fill="black"/>
                    <rect id="t6" x="420" y="120" width="50" height="4" fill="black"/>

                    <line x1="216" y1="51" x2="190" y2="70" stroke="black" stroke-width="2" marker-end="url(#triangle)"/>
                    <line x1="185" y1="74" x2="150" y2="101" stroke="black" stroke-width="2" marker-end="url(#triangle)"/>
                    <line x1="120" y1="145" x2="120" y2="168" stroke="black" stroke-width="2" marker-end="url(#triangle)"/>
                    <line x1="120" y1="179" x2="120" y2="207" stroke="black" stroke-width="2" marker-end="url(#triangle)"/>
                    <line x1="120" y1="265" x2="228" y2="316" stroke="black" stroke-width="2" marker-end="url(#triangle)"/>
                    <line x1="264" y1="51" x2="290" y2="70" stroke="black" stroke-width="2" marker-end="url(#triangle)"/>
                    <line x1="295" y1="74" x2="330" y2="101" stroke="black" stroke-width="2" marker-end="url(#triangle)"/>
                    <line x1="360" y1="145" x2="360" y2="168" stroke="black" stroke-width="2" marker-end="url(#triangle)"/>
                    <line x1="360" y1="179" x2="360" y2="207" stroke="black" stroke-width="2" marker-end="url(#triangle)"/>
                    <line x1="360" y1="265" x2="252" y2="316" stroke="black" stroke-width="2" marker-end="url(#triangle)"/>
                    <path d="M242 324 L242 350 L80 350 L80 40 L207 40" stroke="black" stroke-width="2" fill="none" marker-end="url(#triangle)"/>
                    <path d="M379 105 L440 105 L440 110" stroke="black" stroke-width="2" fill="none" marker-end="url(#triangle)"/>
                    <path d="M440 115 L440 135 L388 135" stroke="black" stroke-width="2" fill="none" marker-end="url(#triangle)"/>
                    <path d="M455 121 L455 244 L393 244" stroke="black" stroke-width="2" fill="none" marker-end="url(#triangle)"/>
                </svg>
            </td>
            <td valign="top">
                <table style="margin-left: 0px; margin-top: 50px" border="0px">
                    <tr><td></td><td><div style="text-align: center; font-family: 'Comic Sans MS';">Введите порядок<br>вложенности</div></td></tr>
                    <tr><td></td><td align="center"><input id="nes" type="number" placeholder="1..10, 10 - default"></td></tr>
                    <tr><td></td><td><div style="text-align: center; font-family: 'Comic Sans MS';">Введите начальную<br>маркировку</div></td></tr>
                    <tr><td>P1</td><td align="center"><input id="p1" type="number" placeholder="0"></td></tr>
                    <tr><td>P2</td><td align="center"><input id="p2" type="number" placeholder="0"></td></tr>
                    <tr><td>P3</td><td align="center"><input id="p3" type="number" placeholder="0"></td></tr>
                    <tr><td>P4</td><td align="center"><input id="p4" type="number" placeholder="0"></td></tr>
                    <tr><td>P5</td><td align="center"><input id="p5" type="number" placeholder="0"></td></tr>
                    <tr><td></td>
                        <td>
                            <label style="font-family: 'Comic Sans MS'; font-size: 12px"><input type="checkbox" id="tree">Раскрыть дерево</label>
                            <div style="text-align: center;">
                                <input style="font-family: 'Comic Sans MS'; width:150px" type="button" id="genTree" onclick="makeStartMark();" value="Построить дерево" />
                            </div>
                        </td>
                    </tr>
                </table>
            </td>
            <td id="append" valign="top"></td>
        </tr>
    </table>
    <div id="chart"></div>
</body>
<script type="text/javascript">
    function makeStartMark(){
        var startMark = [];
        if(Number($('input#p1').val()) && $('input#p1').val() >= 0){
            startMark.push(Number($('input#p1').val()));
        }
        else{
            startMark.push(0);
        }
        if(Number($('input#p2').val()) && $('input#p2').val() >= 0){
            startMark.push(Number($('input#p2').val()));
        }
        else{
            startMark.push(0);
        }
        if(Number($('input#p3').val()) && $('input#p3').val() >= 0){
            startMark.push(Number($('input#p3').val()));
        }
        else{
            startMark.push(0);
        }
        if(Number($('input#p4').val()) && $('input#p4').val() >= 0){
            startMark.push(Number($('input#p4').val()));
        }
        else{
            startMark.push(0);
        }
        if(Number($('input#p5').val()) && $('input#p5').val() >= 0){
            startMark.push(Number($('input#p5').val()));
        }
        else{
            startMark.push(0);
        }
        if(Number($('input#nes').val()) && $('input#nes').val() >= 1 && $('input#nes').val() <= 10){
            var nesting = Number($('input#nes').val());
        }
        else{
            var nesting = 10;
        }

        $('text#p1').text(startMark[0]);
        $('text#p2').text(startMark[1]);
        $('text#p3').text(startMark[2]);
        $('text#p4').text(startMark[3]);
        $('text#p5').text(startMark[4]);

        genTree(startMark, nesting);
        var form = $('<table style="margin-left: 50px; margin-top: 50px" border="0px"><tr><td></td><td align="center"><div style="text-align: center; font-family: Comic Sans MS;">Введите маркировку<br>для поиска</div></td></tr> <tr><td>P1</td><td align="center"><input id="op1" type="number" placeholder="0"></td></tr> <tr><td>P2</td><td align="center"><input id="op2" type="number" placeholder="0"></td></tr> <tr><td>P3</td><td align="center"><input id="op3" type="number" placeholder="0"></td></tr> <tr><td>P4</td><td align="center"><input id="op4" type="number" placeholder="0"></td></tr> <tr><td>P5</td><td align="center"><input id="op5" type="number" placeholder="0"></td></tr> <tr><td></td> <td> <div style="text-align: center;"> <input style="font-family: Comic Sans MS; width:150px" type="button" id="findMark" onclick="findMark();" value="Найти"/> </div> </td> </tr> <tr><td></td><td align="center"><div style="text-align: center; font-family: Comic Sans MS;">Переходы</div></td></tr> <tr><td></td><td align="center"><input id="out_edit" type="text" placeholder="Результат"></td></tr> </table>');
        $('#append').empty();
        $('#append').append(form);
        return;
    }
    function findMark(){
        var mark = [];
        if(Number($('input#op1').val()) && $('input#op1').val() >= 0){
            mark.push(Number($('input#op1').val()));
        }
        else{
            mark.push(0);
        }
        if(Number($('input#op2').val()) && $('input#op2').val() >= 0){
            mark.push(Number($('input#op2').val()));
        }
        else{
            mark.push(0);
        }
        if(Number($('input#op3').val()) && $('input#op3').val() >= 0){
            mark.push(Number($('input#op3').val()));
        }
        else{
            mark.push(0);
        }
        if(Number($('input#op4').val()) && $('input#op4').val() >= 0){
            mark.push(Number($('input#op4').val()));
        }
        else{
            mark.push(0);
        }
        if(Number($('input#op5').val()) && $('input#op5').val() >= 0){
            mark.push(Number($('input#op5').val()));
        }
        else{
            mark.push(0);
        }

        var found = false;
        for(var key in marksArray){
            if(JSON.stringify(marksArray[key]["mark"]) == JSON.stringify(mark)){
                if(marksArray[key]["path"].length == 0){
                    $('#out_edit').val("root");
                }
                else{
                    var output = "";
                    for(var kkey in marksArray[key]["path"]){
                        output = output + marksArray[key]["path"][kkey] + ',';
                    }

                    $('#out_edit').val(output.slice(0, -1));
                }
                found = true;
            }
        }
        if(!found){
            $('#out_edit').val("Маркировка не найдена");
        }
    }
</script>
</html>